#!/bin/bash
clear
echo -e "\033[1;32mDESEJA DESINSTALAR O INFINITENET PLUS MANAGER?\033[1;33m"
read -p "Deseja remover? [s/n] " resp

# Confirma a escolha do usuário
if [[ "$resp" =~ ^[Ss]$ ]]; then
    echo -e "\033[1;31mIniciando o processo de desinstalação...\033[0m"
    
    # Remove pacotes e suprime a saída de erros
    for package in screen nmap figlet squid squid3 dropbear apache2; do
        if dpkg -l | grep -q "^ii  $package"; then
            echo -e "\033[1;33mRemovendo $package...\033[0m"
            apt-get purge "$package" -y >/dev/null 2>&1
            apt-get autoremove -y >/dev/null 2>&1
        else
            echo -e "\033[1;34m$package não encontrado ou já removido.\033[0m"
        fi
    done

    # Remove binários personalizados
    echo -e "\033[1;33mRemovendo scripts e binários personalizados...\033[0m"
    for bin in /bin/criarusuario /bin/expcleaner /bin/sshlimiter /bin/addhost /bin/listar /bin/sshmonitor \
               /bin/ajuda /bin/menu /bin/OpenVPN /bin/userbackup /bin/tcpspeed /bin/badvpn /bin/otimizar \
               /bin/speedtest /bin/trafego /bin/banner /bin/limit /bin/limite /bin/senharoot /bin/reiniciarservicos \
               /bin/reiniciarsistema /bin/attscript /bin/criarteste /bin/socks /bin/DropBear /bin/alterarlimite \
               /bin/alterarsenha /bin/remover /bin/detalhes /bin/mudardata /bin/botssh /bin/infousers /bin/droplimiter \
               /bin/conexao /bin/versao; do
        if [ -f "$bin" ]; then
            rm "$bin" >/dev/null 2>&1
            echo -e "\033[1;32mRemovido: $bin\033[0m"
        fi
    done

    # Remove diretório principal
    if [ -d "/etc/SSHPlus" ]; then
        echo -e "\033[1;33mRemovendo diretório /etc/SSHPlus...\033[0m"
        rm -rf /etc/SSHPlus >/dev/null 2>&1
    fi

    # Mensagem final de agradecimento
    clear
    echo -e "\033[1;36mObrigado por utilizar o INFINITENET PLUS MANAGER.\033[1;33m"
    sleep 2
    
    # Limpa o histórico do bash e finaliza
    cat /dev/null > ~/.bash_history && history -c
    exit 0

else
    echo -e "\033[1;32mOk, retornando ao menu...\033[1;33m"
    sleep 3
    exit
fi
